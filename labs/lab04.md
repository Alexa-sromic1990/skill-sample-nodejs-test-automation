[<< Lab 3](lab03.md) | **Lab 4** | [Lab 5 >>](lab05.md)

# Lab Guide 4 - Set up the Test SDK and Client

## **What you will do in this lab**
The [Test SDK](https://github.com/KayLerch/alexa-skills-kit-tester-java) is an opensource project on Github  which uses SMAPI in a similar way ask-cli does. It keeps track of session state and supports multi-turn dialogs. You'll configure the client tool in this lab to get started for the next labs. 

## **What you will get at the end of this lab**
You have learned how to configure the Test SDK tool and fire a request at the skill that has been defined in a YAML script file.

## **Instructions**

We will use generic Login With Amazon _clientId_ and _clientSecret_ and use the _refreshToken_ generated by
ask-cli in the previous lab. This is just to make the process of setting things up in this workshop easier.
When you're back home, you should set up your _clientId_ and _clientSecret_ and generate your own _refreshToken_. There's a [homework lab](lab04_hw.md) prepared for you with detailled instructions.

### **4.1) Deploy the test environment in AWS** 

You will use a CloudFormation template to create an S3 bucket and a Lambda function which hosts the test client tool written in Java.

**4.1.1.** Go to the [AWS management console](https://console.aws.amazon.com/console/home) and log in with your AWS credentials.

**4.1.2.** Go to _Services_ -> _CloudFormation_ and click on __Create Stack__. 

**4.1.3.** Select __Upload a template to Amazon S3__ and __Choose file__. Navigate to [./assets/aws-stack.json](../assets/aws-stack.json) in this repo. Click __Next__.

**4.1.4.** Set the following
- __Stack name:__ reinvent-alx315
- __lwaClientId, lwaClientSecret__ are already set for you. Those are generic credentials ask-cli used to generate your _refreshToken_. 
- __lwaRefreshToken:__ on your local machine, navigate to your home folder (_$ cd ~_) and open the _.ask/cli_config_ file. ask-cli created it to store your settings when you initialized the tool in the first lab. Copy the _refreshToken_ you find in this file and paste it into the CloudFormation setup page. Please note, if you're not seeing the _.ask_ folder in your home directory, tell your file explorer to also show hidden objects.
- __skillId:__ Here goes the skill-Id of your _number guessing game_ skill. Return to the Amazon developer portal to get it. 

![](img/lab04-screen06.png)

Click on __Next__. 

**4.1.5.** Click on __Next__. 

**4.1.6.** Confirm __I acknowledge that AWS CloudFormation might create IAM resources.__ and click on  __Create__.

The stack creates an S3 bucket and a Lambda function which hosts the test client. When the status indicates _CREATE_COMPLETE_ go to the _Resources_ tab at the bottom of this page.

![](img/lab04-screen07.png)

**4.1.7.** In the _Resources_ tab you should see three resources which have been created in your AWS account. Follow the links to the _TestClientLambda_ and _TestScriptBucket_ resource. Each of them will open in up in a new browser tab. Leave them open until the end of this workshop as you will return to your S3 bucket and Lambda function in the upcoming labs.

### **4.2) Run your first test script** 

We recommend you to use an advanced text editor or IDE. You could also use an [Online YAML editor](https://codebeautify.org/yaml-validator) if you want.

**4.2.1.** Navigate to the [./scripts/lab04.yml](../scripts/lab04.yml) in this repo. This is your first conversation test script. Look at it and familiarize with its content.

**4.2.2.** Return to the S3 bucket windows in your browser. The bucket should have a name similar to _reinvent-alx315-testscriptbucket-xxxxxxxxxx_. 

**4.2.3.** __Upload__ the [./scripts/lab04.yml](../scripts/lab04.yml) from your local drive into this bucket.

**4.2.4.** Switch to the browser tab of your _reinvent-alx315-test-client_ Lambda function. Look at the environment variables already set for you. This Lambda function will access the referenced skill by using your Login With Amazon token.

**4.2.5.** Hit __Test__ to execute the Lambda function. You might have to configure a test event first. Choose the _Hello World_ example event as the Lambda function does not expect anything specific as an input.

**4.2.6.** Look at the _log output_ once the Lambda execution is finished.

__Q4.2.7__: From what is in the [./scripts/lab04.yml](../scripts/lab04.yml) and in the Lambda _log output_, can you describe what just happened?

Congratulations. You ran your first automated test. 

[<< Lab 3](lab03.md) | **Lab 4** | [Lab 5 >>](lab05.md)